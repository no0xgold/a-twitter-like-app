{% extends 'tweets\base.html' %}
{% block head_title %}
what a nice concept!
{% endblock head_title %}

{% block content %}

<div class='row text-center'>
    <div class='col'>
        <h1>Welcom to Tweet</h1>
    </div>
</div>

<div class='row' id='tweets'>
    Loading...
</div>
<script>
const tweetsElement = document.getElementById("tweets") // get an html element  
// tweetsElement.innerHTML = 'loading...' // set new html  in that elemnt
// var el1 = "<h1>Hi there1</h1>"
// var el2 = "<h1>Hi there2</h1>"
// var el3 = "<h1>Hi there3</h1>"
// tweetsElement.innerHTML = el1 + el2 + el3
const xhr = new XMLHttpRequest()
const method = 'GET'//post method
const url = "/tweets"
const responseType = "json"
function handledidLike(tweet_id, currentCount){
    console.log(tweet_id, currentCount)
    return 
}

function LikeBtn(tweet){
    return "<button class='btn btn-primary btn-sm' onclick=handledidLike(" + 
    tweet.id + ","+  tweet.likes + ")>" + tweet.likes  + "  Like</button>"

}

function formatTweetElement(tweet){
    
    
    var formattedTweet = "<div class='col-12 col-md-10 mx-auto border rounded py-3 mb-4 tweet ' id= tweet-'" + tweet.id 
    + "'><p>" + tweet.content + 
        "</p><div class='btn-group'>" + LikeBtn(tweet) +
        "</div></div>" 
    return formattedTweet
}
xhr.responseType = responseType
xhr.open(method, url)
xhr.onload = function(){
    const serverResponse = xhr.response
    const listedItems = serverResponse.response //array
    var finalTweetStr = ""
    var i;
    for (i=0;i<listedItems.length; i++){
        var tweetObj = listedItems[i]
        var currentItem = formatTweetElement(tweetObj)
        finalTweetStr += currentItem
        
    }
    tweetsElement.innerHTML = finalTweetStr
    //console.log(listedItems)
}
xhr.send()
</script>
    {% endblock content %}